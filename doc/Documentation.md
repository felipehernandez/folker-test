# Intro
# Build

```
# Dockerfile

FROM  folkertest/folkertest

COPY  ./  ./

ENTRYPOINT  ["python",  "folker.py"]
```
> docker build -t IMAGE --pull .

# Execution
> docker run IMAGE [PARAMETERS]

|Parameters|Description|Usage|Example|
|-|-|-|-|
| -c, --context		| Set predefined key:value in the **Test context**	| -c KEY:VALUE <br> --context=KEY:VALUE | -c key1:value1 -c key2:value2 <br> --context=key1:value1 |
| -d, --debug 		| Run on Debug log mode 							| -d 									| -d |
| -f, --file		| Execute all tests whose file name are listed. Use quotes ("") if neccesary | -f FILE[,FILE] <br> --file=FILE[,FILE] | -f folker_test_test1.yaml <br> --file=folker_test_1.yaml
| -F, --FILE		| execute all tests whose file name matches the regular expression. Use quotes ("") if neccesary | -F FILE_RE <br> --FILE=FILE_RE | -F f_t_test1.yaml <br> --FILE=f_t_*.yaml
| -l, --log			| Specify a file where output the logs (console by default) | -l FILE <br> --log=FILE | -l logs.log <br> --log=logs.log
| <BLANK> -n		| Specify the expected number of tests to be run | -n NUMBER | -n 42 |
| -p, --Profile		| Specify a profile file to load test context data | -p PROFILE <br> --profile=PROFILE | -p dev-profile <br> --profile=sta-profile 
| -t, --tags  		| Run tests that matches all specified tags 		| -t TAG[,TAG]<br> --tags=TAG[,TAG] | -t tag1,tag2<br> --tags=tag1,tag2
| <BLANK> --trace 	| Run on Trace log mode 							| <BLANK> --trace | <BLANK> --trace |

# Architecture
The test execution starts by initialising the **test context**. This is a key-value map that will hold all data required throught the whole test life cycle. 
Given an initialised **test contect**, the defined stages will be executed in secuential order. Each stage will generate a **stage context** containing all the data generated by a particular **action** executed in the stage. Notice that **stage context** is only visible within the stage and all information will be lost unless it is saved.
Each time we want to access to data stored in any of the contexts we need to specify the key by: **${KEY}**. Folker will try to resolve the key value by first looking into **stage context** and then **test context**, raising an error if the data is not available.

## Test
A tests is defined as follows:
- name: text to identify the test
- description: brief description of the test
- tags: tag the test in case we want to execute just part of the entire test suite
- foreach: key-value pairs that will trigger an entire execution for each combination. The values are listed values that will be added to the **test context** and will be executed separatelly.
- stages: secuential steps to execute as part of the test. 
```
name: Example test  
description: Test description 
tags:  
	- dummy  
	- void  
stages:  
	- name: void_stage  
	  action:  
		  type: VOID  
```
### Stage
Each stage has the following attributes:
- id: template identifier for predefined stages
- name: name to identify the specific stage. This can contain references on the contexts for a more dynamic stage identification
- foreach: key-value pairs to be iterated during the stage execution. The values are listed values that will be added to the **stage context** and will be executed separatelly. It's recommended in case of **save** to use dynamic references *(see foreach example)*.
- action: activity to be perform on the stage. There are several types of *actions* defined bellow.
- save: contain a map to store data in the **test context**.
- log: outputs content.
- assert: perform assertions to verify the stage has behaved as expected.
```
stages:  
	- name: stage 
	  foreach:  
		  element: [ 'alpha', 'beta', 'charlie']
	  action:  
		  type: PRINT  
		  message: Hello ${element} (${element_index})!
	  log:
		  - 'Hello ${element}!'
	  assert:
		  - '${element}' is not None
		  - 1 + 1 == 2
```
#### Action
Defines the unique activity to be perform on the *stage*. Each "action* is identyfy by the attribure **type** among its particular ones. Each *action* performs a different activity and thus define a different output. There are some generated values that are consistent for all *actions*:
- elapsed_time: specifies the time it took the activity to complete.
- error: contains any usefull information to identify the reason the activity could not be completed. This information contains error due to actual perform rather than data related.

The possible activities are as follows:
##### CODE
##### FILE
##### GCP / DATASTORE
##### GCP / PUBSUB
##### GRAPHQL
##### GRPC
##### POSTGRES
##### PRINT
##### PROTOBUF
##### REST
##### VOID
##### WAIT
#### Save
Defines key value pairs so usefull information can be stored on the **test context** for future
```
name: Complex save Test
description: Dummy Test for complex save
tags:
  - dummy
  - save

stages:
  - name: save1
    action:
      type: VOID
    save:
      root.0: value1
      attribute.with.multiple.layers: value

  - name: save2
    action:
      type: VOID
    save:
      root.1: value2

  - name: asserts
    action:
      type: VOID
    assert:
      - ${root.0} == 'value1'
      - ${root.1} == 'value2'
      - ${attribute.with.multiple.layers} == 'value' 
```
Both *key* and *value* accept variable replacement but only *value* supports statement resolution.
```
name: Print Test
description: Dummy Test for Print Stage
tags:
  - dummy
  - print
  - foreach

stages:
  - name: foreach stage
    foreach:
      element: [ 'alpha', 'beta', 'charlie']
    action:
      type: PRINT
      message: Hello ${element} (${element_index})!
    save:
      elements.${element_index}: ${element}

  - name: assertions
    foreach:
      value: ${elements}
    action:
      type: VOID
    assert:
      - ${elements.0} == 'alpha'
      - ${elements.1} == 'beta'
      - ${elements.2} == 'charlie'

  - name: multiple variables foreach
    foreach:
      element1: [ 1, 2 ]
      element2: [ 3, 7 ]
    action:
      type: VOID
    save:
      elements.${element1_index}${element2_index}: ${element1}+${element2}

  - name: assert complex save
    action:
      type: VOID
    assert:
      - ${elements.00} == 4
      - ${elements.01} == 8
      - ${elements.10} == 5
      - ${elements.11} == 9
```
#### Log
Contains a list of texts that will be printed for the desired report out.
```
name: Void Test
description: Dummy Test for Void Stage
tags:
  - dummy
  - void

stages:
  - name: void_stage
    action:
      type: VOID
    save:
      test: 'passing'
    log:
      - 'Hello world'
```
#### Assert
Contains a list of statements that will be asserted after the *activity* is performed.
```
stages:
  - name: example
    action:
      type: VOID
    save:
      root.0: value1
      attribute.with.multiple.layers: value
    assert:
      - 1+1 == 2
      - len(['']) == 1
      - ${root.0} == 'value1'
      - ${attribute.with.multiple.layers} == 'value'
```
## Template
## Profile