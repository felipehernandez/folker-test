name: GRPC Test
description: Dummy Test for GRPC Stage

stages:
  - name: proto-create
    action:
      type: PROTOBUF
      method: CREATE
      package: protos.TestProto_pb2
      class: TestRequest
      data:
        firstName: Test
        lastName: ing1
    save:
      host: 12.34.56.78:8080
      request: ${proto_object}
      serialised_request: ${proto_serialize}

  - name: call server single
    action:
      type: GRPC
      host: ${host}
      package: protos.TestProto_pb2_grpc
      stub: TestServiceStub
      method: hello
      data: request
    save:
      response: ${response}
    log:
      - ${elapsed_time}
      - ${response}
    assert:
      - ${response} is not None

  - name: call server stream
    action:
      type: GRPC
      host: ${host}
      package: protos.TestProto_pb2_grpc
      stub: TestServiceStub
      method: hellos
      data: request
    save:
      response: ${response}
    log:
      - ${elapsed_time}
      - ${response}
    assert:
      - ${response} is not None
      - len(${response}) > 1
